#!/bin/bash
# Pre-commit hook that runs ruff format and pyright

set -e

# Get list of staged Python files
STAGED_PY_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)

if [ -z "$STAGED_PY_FILES" ]; then
    exit 0
fi

# Format staged files with ruff (transparent formatting)
echo "Formatting staged Python files..."
echo "$STAGED_PY_FILES" | xargs uv run ruff format

# Re-stage the formatted files
echo "$STAGED_PY_FILES" | xargs git add

# Run ruff linting on staged files
echo "Linting staged Python files..."
echo "$STAGED_PY_FILES" | xargs uv run ruff check

# Run pyright type checking
echo "Type checking..."
uv run pyright $STAGED_PY_FILES
